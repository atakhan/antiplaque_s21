# ТЕХНИЧЕСКОЕ ЗАДАНИЕ ДЛЯ МИКРОСЕРВИСА АВТОРИЗАЦИИ
## 1. Введение

Микросервис авторизации предназначен для управления процессами регистрации, аутентификации и авторизации пользователей в рамках микросервисной архитектуры. Он должен обеспечивать безопасный доступ к различным сервисам для пользователей с разными ролями (для пиров и для админов).

## 2. Цели и задачи

-   Реализовать регистрацию и аутентификацию юзеров-пиров для публичного сайта.
-   Обеспечить авторизацию юзеров с различными ролями для приватной админки.
-   Предоставить API для взаимодействия с другими микросервисами.
-   Управлять админами микросервисов и модераторами.
-   Обеспечить безопасность и отказоустойчивость системы авторизации (чтобы только наши микросервисы могли юзать твой сервис)

## 3. Функциональные требования

### 3.1 Гостевые и клиентские эндпоинты

1.  **Регистрация пользователей**
    -   Эндпоинт:  `POST /register`
    -   Параметры:
        -   `email`  (string): Электронная почта пользователя.
        -   `password`  (string): Пароль пользователя.
    -   Ответ:
        -   Статус 201: Пользователь успешно зарегистрирован, отправлено письмо с кодом подтверждения.
        -   Статус 400: Ошибка при регистрации (например, некорректный email).
2.  **Подтверждение регистрации**
    -   Эндпоинт:  `POST /confirm`
    -   Параметры:
        -   `email`  (string): Электронная почта пользователя.
        -   `confirmation_code`  (string): Код подтверждения, отправленный на почту.
    -   Ответ:
        -   Статус 200: Регистрация подтверждена.
        -   Статус 400: Ошибка подтверждения (например, неверный код).
3.  **Аутентификация пользователей**
    -   Эндпоинт:  `POST /login`
    -   Параметры:
        -   `email`  (string): Электронная почта пользователя.
        -   `password`  (string): Пароль пользователя.
    -   Ответ:
        -   Статус 200: Успешная аутентификация, возвращается JWT-токен.
        -   Статус 401: Ошибка аутентификации (неверный email или пароль).
4.  **Восстановление пароля**
    -   Эндпоинт:  `POST /reset-password`
    -   Параметры:
        -   `email`  (string): Электронная почта пользователя.
    -   Ответ:
        -   Статус 200: Письмо с инструкциями по восстановлению пароля отправлено.
        -   Статус 400: Ошибка при восстановлении пароля (например, email не найден).
5.  **Подтверждение нового пароля**
    -   Эндпоинт:  `POST /update-password`
    -   Параметры:
        -   `email`  (string): Электронная почта пользователя.
        -   `new_password`  (string): Новый пароль.
        -   `reset_code`  (string): Код для сброса пароля, отправленный на почту.
    -   Ответ:
        -   Статус 200: Пароль успешно обновлен.
        -   Статус 400: Ошибка при обновлении пароля (например, неверный код).

### 3.2 Админские эндпоинты

1.  **Аутентификация администраторов**
    -   Эндпоинт:  `POST /admin/login`
    -   Параметры:
        -   `username`  (string): Логин администратора.
        -   `password`  (string): Пароль администратора.
    -   Ответ:
        -   Статус 200: Успешная аутентификация, возвращается JWT-токен.
        -   Статус 401: Ошибка аутентификации (неверный логин или пароль).
2.  **Регистрация микросервиса и его админа**
    -   Эндпоинт:  `POST /admin/services`
    -   Параметры:
        -   `service_name`  (string): Название микросервиса.
        -   `username`  (string): логин администратора микросервиса.
        -   `email`  (string): Электронная почта администратора микросервиса.
        -   `password`  (string): Пароль администратора микросервиса.
    -   Ответ:
        -   Статус 201: Микросервис и администратор успешно зарегистрированы.
        -   Статус 400: Ошибка при регистрации (например, дублирование названия).
3.  **Получение списка микросервисов и их админов**
    -   Эндпоинт:  `GET /admin/services`
    -   Ответ:
        -   Статус 200: Возвращает список всех зарегистрированных микросервисов и их администраторов.
4.  **Получение списка всех модераторов**
    -   Эндпоинт:  `GET /admin/moderators`
    -   Ответ:
        -   Статус 200: Возвращает список всех модераторов.
5.  **Создание модератора**
    -   Эндпоинт:  `POST /admin/moderators`
    -   Параметры:
        -   `email`  (string): Электронная почта модератора.
        -   `password`  (string): Пароль модератора.
    -   Ответ:
        -   Статус 201: Модератор успешно создан.
        -   Статус 400: Ошибка при создании модератора (например, дублирование email).
6.  **Удаление модератора**
    -   Эндпоинт:  `DELETE /admin/moderators/:moderator_id`
    -   Ответ:
        -   Статус 200: Модератор успешно удален.
        -   Статус 404: Модератор не найден.

## 4. Нефункциональные требования
-   Использование надежных алгоритмов хеширования паролей.
-   Реализация механизмов защиты от CSRF, XSS и других атак.
-   Шифрование трафика между микросервисами (возможно, не будем).
-   Интеграция с системами мониторинга (например, Prometheus, Grafana, тут с Булатом будете общаться).
-   Ведение подробных логов для анализа и отладки (тоже к булатикусу).

## 5. Технологический стек

-   **Язык программирования**: На твое усмотрение
-   **Фреймворк**: На твое усмотрение
-   **База данных**: На твое усмотрение
-   **Аутентификация**: JWT (JSON Web Tokens)
-   **Контейнеризация**: Docker

## 6. Архитектура

Микросервис авторизации будет состоять из следующих компонентов:

1.  **API-сервер**: Обрабатывает входящие запросы на регистрацию, аутентификацию и управление ролями.
2.  **Сервис аутентификации**: Отвечает за проверку учетных данных пользователей и выдачу JWT-токенов.
3.  **Сервис авторизации**: Управляет ролями пользователей и проверяет права доступа.
4.  **Сервис управления пользователями**: Отвечает за CRUD-операции с пользовательскими данными.
5.  **Сервис управления глобальным администратором**: Отвечает за создание и управление глобальным администратором.